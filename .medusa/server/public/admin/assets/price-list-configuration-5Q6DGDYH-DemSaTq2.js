import{P as F}from"./chunk-OJWRQENW-VmFHMEkR.js";import{a2 as N,d8 as L,ad as E,a4 as A,b as D,R as I,dw as M,dv as k,j as s,H as P,a8 as G,a9 as H,y as O,dA as R,t as S,w as r,D as _,m as z,bv as B,B as C,T as K,I as V,X}from"./index-BuxV6e0B.js";import"./chunk-B2JT2FOA-DJQBCjEL.js";import"./lodash-ButGdqO5.js";import"./chunk-GJUPECDU-BESkt2FL.js";import{K as U}from"./chunk-6HTZNHPT-46xTxqsX.js";import{b as c,u as $,a as q,c as m}from"./chunk-4TC5YS65-D1UjD2uU.js";import{D as T}from"./date-picker-BgV4eukK.js";import"./chunk-ZJRFL6ZN-CRSQ8XwM.js";import"./chunk-C76H5USB-D-emvUqZ.js";import"./chunk-MSDRGCRR-CRD82HQO.js";import"./chunk-P3UUX2T6-Ch2QR5m0.js";import"./index-DwpPW5sH.js";import"./checkbox-DhpTDumb.js";import"./chunk-YEDAFXMB-CqqVMwDO.js";import"./chunk-AOFGTNG6-DlDZWCol.js";import"./table-Dco6R2DT.js";import"./chunk-EMIHDNB7-_mWCmww0.js";import"./plus-mini-mxvx0kJJ.js";import"./command-bar-BrgaOCRr.js";import"./index-D9jlmLrk.js";import"./chunk-PFKKVLZX-WcuAW0zc.js";import"./format-7IPiT4y7.js";import"./_isIndex-CcRlYrDe.js";import"./x-mark-mini-DsfxIEYF.js";import"./index-BDd3Q1eQ.js";import"./prompt-BbGWPD2t.js";import"./popover-12uuNIe1.js";import"./triangle-left-mini-C0Rjyu6C.js";var J=N({ends_at:L().nullable(),starts_at:L().nullable(),customer_group_id:E(N({id:A(),name:A()}))}),w="cg",Q=({priceList:d,customerGroups:f})=>{const{t:e}=D(),{handleSuccess:p}=$(),{setIsOpen:x}=q(),o=G({defaultValues:{ends_at:d.ends_at?new Date(d.ends_at):null,starts_at:d.starts_at?new Date(d.starts_at):null,customer_group_id:f},resolver:H(J)}),{fields:t,remove:u,append:g}=O({control:o.control,name:"customer_group_id",keyName:"cg_id"}),j=i=>{if(!i.length){o.setValue("customer_group_id",[]),x(w,!1);return}const n=i.map(a=>a.id),l=i.filter(a=>!t.some(h=>h.id===a.id));for(const a of t)n.includes(a.id)||u(t.indexOf(a));g(l),x(w,!1)},{mutateAsync:b}=R(d.id),y=o.handleSubmit(async i=>{var a,h;const n=i.customer_group_id.map(v=>v.id),l={...d.rules};n.length?l["customer.groups.id"]=n:delete l["customer.groups.id"],await b({starts_at:((a=i.starts_at)==null?void 0:a.toISOString())||null,ends_at:((h=i.ends_at)==null?void 0:h.toISOString())||null,rules:l},{onSuccess:()=>{S.success(e("priceLists.configuration.edit.successToast")),p()},onError:v=>S.error(v.message)})});return s.jsxs(c.Form,{form:o,children:[s.jsx(c.Description,{className:"sr-only",children:e("priceLists.configuration.edit.description")}),s.jsxs(U,{className:"flex flex-1 flex-col overflow-hidden",onSubmit:y,children:[s.jsxs(c.Body,{className:"flex flex-1 flex-col gap-y-8 overflow-auto",children:[s.jsx(r.Field,{control:o.control,name:"starts_at",render:({field:i})=>s.jsxs(r.Item,{children:[s.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[s.jsxs("div",{className:"flex flex-col",children:[s.jsx(r.Label,{optional:!0,children:e("priceLists.fields.startsAt.label")}),s.jsx(r.Hint,{children:e("priceLists.fields.startsAt.hint")})]}),s.jsx(r.Control,{children:s.jsx(T,{granularity:"minute",shouldCloseOnSelect:!1,...i})})]}),s.jsx(r.ErrorMessage,{})]})}),s.jsx(_,{}),s.jsx(r.Field,{control:o.control,name:"ends_at",render:({field:i})=>s.jsxs(r.Item,{children:[s.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[s.jsxs("div",{className:"flex flex-col",children:[s.jsx(r.Label,{optional:!0,children:e("priceLists.fields.endsAt.label")}),s.jsx(r.Hint,{children:e("priceLists.fields.endsAt.hint")})]}),s.jsx(r.Control,{children:s.jsx(T,{granularity:"minute",shouldCloseOnSelect:!1,...i})})]}),s.jsx(r.ErrorMessage,{})]})}),s.jsx(_,{}),s.jsx(r.Field,{control:o.control,name:"customer_group_id",render:({field:i})=>s.jsxs(r.Item,{children:[s.jsxs("div",{children:[s.jsx(r.Label,{optional:!0,children:e("priceLists.fields.customerAvailability.label")}),s.jsx(r.Hint,{children:e("priceLists.fields.customerAvailability.hint")})]}),s.jsx(r.Control,{children:s.jsxs("div",{className:z("bg-ui-bg-component shadow-elevation-card-rest transition-fg grid gap-1.5 rounded-xl py-1.5","aria-[invalid='true']:shadow-borders-error"),role:"application",ref:i.ref,children:[s.jsxs("div",{className:"text-ui-fg-subtle grid gap-1.5 px-1.5 md:grid-cols-2",children:[s.jsx("div",{className:"bg-ui-bg-field shadow-borders-base txt-compact-small rounded-md px-2 py-1.5",children:e("priceLists.fields.customerAvailability.attribute")}),s.jsx("div",{className:"bg-ui-bg-field shadow-borders-base txt-compact-small rounded-md px-2 py-1.5",children:e("operators.in")})]}),s.jsx("div",{className:"flex items-center gap-1.5 px-1.5",children:s.jsxs(m,{id:w,children:[s.jsx(m.Trigger,{asChild:!0,children:s.jsxs("button",{type:"button",className:"bg-ui-bg-field shadow-borders-base txt-compact-small text-ui-fg-muted flex flex-1 items-center gap-x-2 rounded-md px-2 py-1.5",children:[s.jsx(B,{}),e("priceLists.fields.customerAvailability.placeholder")]})}),s.jsx(m.Trigger,{asChild:!0,children:s.jsx(C,{variant:"secondary",children:e("actions.browse")})}),s.jsxs(m.Content,{children:[s.jsxs(m.Header,{children:[s.jsx(m.Title,{asChild:!0,children:s.jsx(P,{children:e("priceLists.fields.customerAvailability.header")})}),s.jsx(m.Description,{className:"sr-only",children:e("priceLists.fields.customerAvailability.hint")})]}),s.jsx(F,{type:"drawer",setState:j,state:t})]})]})}),t.length>0?s.jsxs("div",{className:"flex flex-col gap-y-1.5",children:[s.jsx(_,{variant:"dashed"}),s.jsx("div",{className:"flex flex-col gap-y-1.5 px-1.5",children:t.map((n,l)=>s.jsxs("div",{className:"bg-ui-bg-field-component shadow-borders-base flex items-center justify-between gap-2 rounded-md px-2 py-0.5",children:[s.jsx(K,{size:"small",leading:"compact",children:n.name}),s.jsx(V,{size:"small",variant:"transparent",type:"button",onClick:()=>u(l),children:s.jsx(X,{})})]},n.cg_id))})]}):null]})}),s.jsx(r.ErrorMessage,{})]})})]}),s.jsx(c.Footer,{className:"shrink-0",children:s.jsxs("div",{className:"flex items-center justify-end gap-x-2",children:[s.jsx(c.Close,{asChild:!0,children:s.jsx(C,{size:"small",variant:"secondary",children:e("actions.cancel")})}),s.jsx(C,{size:"small",type:"submit",children:e("actions.save")})]})})]})]})},Ls=()=>{var l;const{t:d}=D(),{id:f}=I(),{price_list:e,isPending:p,isError:x,error:o}=M(f),t=(l=e==null?void 0:e.rules)==null?void 0:l["customer.groups.id"],{customer_groups:u,isPending:g,isError:j,error:b}=k({id:t},{enabled:!!(t!=null&&t.length)}),y=(u==null?void 0:u.map(a=>({id:a.id,name:a.name})))||[],i=p?!1:!(t!=null&&t.length&&g),n=!p&&!!e&&i;if(x)throw o;if(j)throw b;return s.jsxs(c,{children:[s.jsx(c.Header,{children:s.jsx(c.Title,{asChild:!0,children:s.jsx(P,{children:d("priceLists.configuration.edit.header")})})}),n&&s.jsx(Q,{priceList:e,customerGroups:y})]})};export{Ls as Component};
