import{K as _}from"./chunk-6HTZNHPT-CuK6NmIV.js";import{R as d,u as v}from"./chunk-4TC5YS65-NVxWjOau.js";import{a2 as f,ad as N,a4 as j,a5 as C,R as k,aS as S,j as e,b as w,cV as F,a8 as T,a9 as E,y as H,t as y,B as b,H as L,w as a,x as M,ab as R}from"./index-Cny3qPON.js";import"./prompt-KlOiT8I5.js";var O=f({labels:N(f({tracking_number:j(),tracking_url:j().optional(),label_url:j().optional()})),send_notification:C().optional()});function z({order:c,fulfillment:r}){const{t:s}=w(),{handleSuccess:x}=v(),{mutateAsync:h,isPending:u}=F(c.id,r==null?void 0:r.id),i=T({defaultValues:{send_notification:!c.no_notification},resolver:E(O)}),{fields:m,append:p}=H({name:"labels",control:i.control}),g=i.handleSubmit(async t=>{var l;const o=t.labels.filter(n=>!!n.tracking_number).map(n=>({tracking_number:n.tracking_number,tracking_url:"#",label_url:"#"}));await h({items:(l=r==null?void 0:r.items)==null?void 0:l.map(n=>({id:n.line_item_id,quantity:n.quantity})),labels:[...o,...(r==null?void 0:r.labels)||[]],no_notification:!t.send_notification},{onSuccess:()=>{y.success(s("orders.shipment.toastCreated")),x(`/orders/${c.id}`)},onError:n=>{y.error(n.message)}})});return e.jsx(d.Form,{form:i,children:e.jsxs(_,{onSubmit:g,className:"flex h-full flex-col overflow-hidden",children:[e.jsx(d.Header,{children:e.jsxs("div",{className:"flex items-center justify-end gap-x-2",children:[e.jsx(d.Close,{asChild:!0,children:e.jsx(b,{size:"small",variant:"secondary",children:s("actions.cancel")})}),e.jsx(b,{size:"small",type:"submit",isLoading:u,children:s("actions.save")})]})}),e.jsx(d.Body,{className:"flex h-full w-full flex-col items-center divide-y overflow-y-auto",children:e.jsx("div",{className:"flex size-full flex-col items-center overflow-auto p-16",children:e.jsx("div",{className:"flex w-full max-w-[736px] flex-col justify-center px-2 pb-2",children:e.jsxs("div",{className:"flex flex-col divide-y",children:[e.jsxs("div",{className:"flex flex-1 flex-col",children:[e.jsx(L,{className:"mb-4",children:s("orders.shipment.title")}),m.map((t,o)=>e.jsx(a.Field,{control:i.control,name:`labels.${o}.tracking_number`,render:({field:l})=>e.jsxs(a.Item,{className:"mb-4",children:[o===0&&e.jsx(a.Label,{children:s("orders.shipment.trackingNumber")}),e.jsx(a.Control,{children:e.jsx(M,{...l,placeholder:"123-456-789"})}),e.jsx(a.ErrorMessage,{})]})},t.id)),e.jsx(b,{type:"button",onClick:()=>p({tracking_number:""}),className:"self-end",variant:"secondary",children:s("orders.shipment.addTracking")})]}),e.jsx("div",{className:"mt-8 pt-8 ",children:e.jsx(a.Field,{control:i.control,name:"send_notification",render:({field:{onChange:t,value:o,...l}})=>e.jsxs(a.Item,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(a.Label,{children:s("orders.shipment.sendNotification")}),e.jsx(a.Control,{children:e.jsx(a.Control,{children:e.jsx(R,{checked:!!o,onCheckedChange:t,...l})})})]}),e.jsx(a.Hint,{className:"!mt-1",children:s("orders.shipment.sendNotificationHint")}),e.jsx(a.ErrorMessage,{})]})})})]})})})})]})})}function A(){var m;const{id:c,f_id:r}=k(),{order:s,isLoading:x,isError:h,error:u}=S(c,{fields:"*fulfillments,*fulfillments.items,*fulfillments.labels"});if(h)throw u;const i=!x&&s;return e.jsx(d,{children:i&&e.jsx(z,{order:s,fulfillment:(m=s.fulfillments)==null?void 0:m.find(p=>p.id===r)})})}export{A as Component};
