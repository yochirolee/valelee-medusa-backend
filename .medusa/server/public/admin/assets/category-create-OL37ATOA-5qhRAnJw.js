import{C as K}from"./chunk-XDCNT5GQ-B4Yvt4r3.js";import{i as $}from"./chunk-54IEHX46-DWMq7yL7.js";import{H as W}from"./chunk-7OYLCEKK-Ckh1udod.js";import{t as Y}from"./chunk-3ISBJK7K-BPFEXhG7.js";import{K as q}from"./chunk-6HTZNHPT-46xTxqsX.js";import{R as m,u as G}from"./chunk-4TC5YS65-D1UjD2uU.js";import{a2 as B,a4 as _,a3 as H,af as J,a0 as O,j as e,b as M,r as h,a8 as Q,a9 as U,aH as X,t as R,B as V,H as Z,T as ee,w as s,x as se,ag as ae,v as P,Y as re}from"./index-BuxV6e0B.js";import{P as u}from"./progress-tabs-BsCkULyj.js";import{T as te}from"./textarea-DTXhPein.js";import{S as n}from"./select-CQL-hkLJ.js";import"./sortable.esm-ClNOjdrB.js";import"./dots-six-0WXFuz3H.js";import"./folder-illustration-BYYGJ_A2.js";import"./chunk-6GU6IDUA-CDc7wW5L.js";import"./prompt-BbGWPD2t.js";import"./triangles-mini-DtEEpPAa.js";import"./check-BG9u5Zj7.js";var ie=({form:r})=>{const{t:a}=M();return e.jsx("div",{className:"flex flex-col items-center p-16",children:e.jsxs("div",{className:"flex w-full max-w-[720px] flex-col gap-y-8",children:[e.jsxs("div",{children:[e.jsx(Z,{children:a("categories.create.header")}),e.jsx(ee,{size:"small",className:"text-ui-fg-subtle",children:a("categories.create.hint")})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsx(s.Field,{control:r.control,name:"name",render:({field:t})=>e.jsxs(s.Item,{children:[e.jsx(s.Label,{children:a("fields.title")}),e.jsx(s.Control,{children:e.jsx(se,{autoComplete:"off",...t})}),e.jsx(s.ErrorMessage,{})]})}),e.jsx(s.Field,{control:r.control,name:"handle",render:({field:t})=>e.jsxs(s.Item,{children:[e.jsx(s.Label,{optional:!0,tooltip:a("collections.handleTooltip"),children:a("fields.handle")}),e.jsx(s.Control,{children:e.jsx(W,{...t})}),e.jsx(s.ErrorMessage,{})]})})]}),e.jsx(s.Field,{control:r.control,name:"description",render:({field:t})=>e.jsxs(s.Item,{children:[e.jsx(s.Label,{optional:!0,children:a("fields.description")}),e.jsx(s.Control,{children:e.jsx(te,{...t})}),e.jsx(s.ErrorMessage,{})]})}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsx(s.Field,{control:r.control,name:"status",render:({field:{ref:t,onChange:o,...c}})=>e.jsxs(s.Item,{children:[e.jsx(s.Label,{children:a("categories.fields.status.label")}),e.jsx(s.Control,{children:e.jsxs(n,{...c,onValueChange:o,children:[e.jsx(n.Trigger,{ref:t,children:e.jsx(n.Value,{})}),e.jsxs(n.Content,{children:[e.jsx(n.Item,{value:"active",children:a("categories.fields.status.active")}),e.jsx(n.Item,{value:"inactive",children:a("categories.fields.status.inactive")})]})]})}),e.jsx(s.ErrorMessage,{})]})}),e.jsx(s.Field,{control:r.control,name:"visibility",render:({field:{ref:t,onChange:o,...c}})=>e.jsxs(s.Item,{children:[e.jsx(s.Label,{children:a("categories.fields.visibility.label")}),e.jsx(s.Control,{children:e.jsxs(n,{...c,onValueChange:o,children:[e.jsx(n.Trigger,{ref:t,children:e.jsx(n.Value,{})}),e.jsxs(n.Content,{children:[e.jsx(n.Item,{value:"public",children:a("categories.fields.visibility.public")}),e.jsx(n.Item,{value:"internal",children:a("categories.fields.visibility.internal")})]})]})}),e.jsx(s.ErrorMessage,{})]})})]})]})})},L="new-item",ne=({form:r,shouldFreeze:a})=>{const{t}=M(),[o,c]=h.useState([]),{product_categories:x,isPending:T,isError:w,error:j}=ae({parent_category_id:"null",limit:9999,fields:"id,name,parent_category_id,rank,category_children,rank",include_descendants_tree:!0}),i=P({control:r.control,name:"parent_category_id"}),g=P({control:r.control,name:"rank"}),p=P({control:r.control,name:"name"}),N=h.useMemo(()=>$(x??[],{id:L,name:p,parent_category_id:i,rank:g,category_children:null}),[x,p,i,g]),S=({parentId:l,index:f},v)=>{r.setValue("parent_category_id",l,{shouldDirty:!0,shouldTouch:!0}),r.setValue("rank",f,{shouldDirty:!0,shouldTouch:!0}),c(v)};if(w)throw j;const z=!T&&!!x;return e.jsx(K,{value:a?o:N,enableDrag:l=>l.id===L,onChange:S,renderValue:l=>l.id===L?e.jsxs("div",{className:"flex items-center gap-x-3",children:[e.jsx("span",{children:l.name}),e.jsx(re,{size:"2xsmall",color:"blue",children:t("categories.fields.new.label")})]}):l.name,isLoading:!z})},A=B({name:_().min(1),description:_().optional(),handle:_().optional(),status:H(["active","inactive"]),visibility:H(["public","internal"])}),le=B({rank:J().nullable(),parent_category_id:_().nullable()}).merge(A),oe=({parentCategoryId:r})=>{var f,v;const{t:a}=M(),{handleSuccess:t}=G(),[o,c]=h.useState("details"),[x,T]=h.useState(!1),[w,j]=h.useState(!1),i=Q({defaultValues:{name:"",description:"",handle:"",status:"active",visibility:"public",rank:r?0:null,parent_category_id:r},resolver:U(le)}),g=d=>{if(d==="organize"){const{name:F,handle:I,description:k,status:D,visibility:E}=i.getValues(),y=A.safeParse({name:F,handle:I,description:k,status:D,visibility:E});if(!y.success){y.error.errors.forEach(b=>{i.setError(b.path.join("."),{type:"manual",message:b.message})});return}i.clearErrors(),T(!0)}c(d)},{mutateAsync:p,isPending:N}=X(),S=i.handleSubmit(d=>{const{visibility:F,status:I,parent_category_id:k,rank:D,name:E,...y}=d,b=Y(y,!1);j(!0),p({name:E,...b,parent_category_id:k??void 0,rank:D??void 0,is_active:I==="active",is_internal:F==="internal"},{onSuccess:({product_category:C})=>{R.success(a("categories.create.successToast",{name:C.name})),t(`/categories/${C.id}`)},onError:C=>{R.error(C.message),j(!1)}})}),z=(f=i.getFieldState("parent_category_id"))!=null&&f.isDirty||(v=i.getFieldState("rank"))!=null&&v.isDirty||o==="organize"?"in-progress":"not-started",l=x?"completed":"in-progress";return e.jsx(m.Form,{form:i,children:e.jsx(q,{onSubmit:S,className:"flex size-full flex-col overflow-hidden",children:e.jsxs(u,{value:o,onValueChange:d=>g(d),className:"flex size-full flex-col",children:[e.jsx(m.Header,{children:e.jsx("div",{className:"flex w-full items-center justify-between",children:e.jsx("div",{className:"-my-2 w-full max-w-[400px] border-l",children:e.jsxs(u.List,{className:"grid w-full grid-cols-2",children:[e.jsx(u.Trigger,{value:"details",status:l,className:"w-full min-w-0 overflow-hidden",children:e.jsx("span",{className:"truncate",children:a("categories.create.tabs.details")})}),e.jsx(u.Trigger,{value:"organize",status:z,className:"w-full min-w-0 overflow-hidden",children:e.jsx("span",{className:"truncate",children:a("categories.create.tabs.organize")})})]})})})}),e.jsxs(m.Body,{className:"flex size-full flex-col overflow-auto",children:[e.jsx(u.Content,{value:"details",children:e.jsx(ie,{form:i})}),e.jsx(u.Content,{value:"organize",className:"bg-ui-bg-subtle flex-1",children:e.jsx(ne,{form:i,shouldFreeze:w})})]}),e.jsx(m.Footer,{children:e.jsxs("div",{className:"flex items-center justify-end gap-x-2",children:[e.jsx(m.Close,{asChild:!0,children:e.jsx(V,{size:"small",variant:"secondary",children:a("actions.cancel")})}),o==="organize"?e.jsx(V,{size:"small",variant:"primary",type:"submit",isLoading:N,children:a("actions.save")},"submit-btn"):e.jsx(V,{size:"small",variant:"primary",type:"button",onClick:()=>g("organize"),children:a("actions.continue")},"continue-btn")]})})]})})})},Ne=()=>{const[r]=O(),a=r.get("parent_category_id");return e.jsx(m,{children:e.jsx(oe,{parentCategoryId:a})})};export{Ne as Component};
