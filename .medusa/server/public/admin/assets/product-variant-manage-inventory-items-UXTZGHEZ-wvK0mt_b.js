import{V as F}from"./chunk-EUTK2A3J-CZpwcbuN.js";import{u as w}from"./chunk-HFB3OQXI-zszBHM9f.js";import{C as E}from"./chunk-2PMSBTXI-DaZX0T6G.js";import{c as g}from"./chunk-6GU6IDUA-CDc7wW5L.js";import{K as S}from"./chunk-6HTZNHPT-AiCRXI8I.js";import{R as h,u as M}from"./chunk-4TC5YS65-WmRz150Y.js";import{a2 as j,ad as P,a4 as q,ap as b,ae as R,af as $,ao as T,R as z,a7 as k,j as e,b as V,a8 as B,a9 as L,y as A,v as C,aG as K,t as I,B as f,H,w as d,s as D,z as N,x as O,I as X}from"./index-B1ljKk9e.js";import{X as G}from"./x-mark-mini-EeQGs_oW.js";import"./triangles-mini-U9BoX_8v.js";import"./plus-mini-DYNDC2my.js";import"./prompt-CzfsqadD.js";var W=j({inventory:P(j({inventory_item_id:q().min(1,b.t("products.variant.inventory.validation.itemId")),required_quantity:R([$(),q()])}).superRefine((t,i)=>{(t.required_quantity?g(t.required_quantity):0)<1&&i.addIssue({code:T.custom,message:b.t("products.variant.inventory.validation.quantity"),path:["required_quantity"]})}))});function Z({form:t,inventoryIndex:i,inventoryItem:u,isItemOptionDisabled:l,onRemove:m}){const{t:a}=V(),_=C({control:t.control,name:`inventory.${i}.inventory_item_id`}),y=w({queryKey:["inventory_items"],defaultValueKey:"id",defaultValue:u.inventory_item_id,selectedValue:_,queryFn:c=>D.admin.inventoryItem.list(c),getOptions:c=>c.inventory_items.map(r=>({label:`${r.title} ${r.sku?`(${r.sku})`:""}`,value:r.id}))});return e.jsxs("li",{className:"bg-ui-bg-component shadow-elevation-card-rest grid grid-cols-[1fr_28px] items-center gap-1.5 rounded-xl p-1.5",children:[e.jsxs("div",{className:"grid grid-cols-[min-content,1fr] items-center gap-1.5",children:[e.jsx("div",{className:"flex items-center px-2 py-1.5",children:e.jsx(N,{size:"xsmall",weight:"plus",className:"text-ui-fg-subtle",htmlFor:`inventory.${i}.inventory_item_id`,children:a("fields.item")})}),e.jsx(d.Field,{control:t.control,name:`inventory.${i}.inventory_item_id`,render:({field:c})=>e.jsxs(d.Item,{children:[e.jsx(d.Control,{children:e.jsx(E,{...c,options:y.options.map(r=>({...r,disabled:l(r,i)})),searchValue:y.searchValue,onSearchValueChange:y.onSearchValueChange,onBlur:()=>y.onSearchValueChange(""),fetchNextPage:y.fetchNextPage,className:"bg-ui-bg-field-component hover:bg-ui-bg-field-component-hover",placeholder:a("products.create.inventory.itemPlaceholder")})}),e.jsx(d.ErrorMessage,{})]})}),e.jsx("div",{className:"flex items-center px-2 py-1.5",children:e.jsx(N,{size:"xsmall",weight:"plus",className:"text-ui-fg-subtle",htmlFor:`inventory.${i}.required_quantity`,children:a("fields.quantity")})}),e.jsx(d.Field,{control:t.control,name:`inventory.${i}.required_quantity`,render:({field:{onChange:c,value:r,...v}})=>e.jsxs(d.Item,{children:[e.jsx(d.Control,{children:e.jsx(O,{type:"number",className:"bg-ui-bg-field-component",min:0,value:r,onChange:c,...v,placeholder:a("products.create.inventory.quantityPlaceholder")})}),e.jsx(d.ErrorMessage,{})]})})]}),e.jsx(X,{type:"button",size:"small",variant:"transparent",className:"text-ui-fg-muted",onClick:m,children:e.jsx(G,{})})]},u.id)}function J({variant:t}){const{t:i}=V(),{handleSuccess:u}=M(),l=B({defaultValues:{inventory:t.inventory_items.length?t.inventory_items.map(o=>({required_quantity:o.required_quantity,inventory_item_id:o.inventory.id})):[{inventory_item_id:"",required_quantity:""}]},resolver:L(W)}),m=A({control:l.control,name:"inventory"}),a=C({control:l.control,name:"inventory"}),_=(o,p)=>!!(a!=null&&a.some((x,s)=>s!=p&&x.inventory_item_id===o.value)),y=m.fields.length>1,{mutateAsync:c,isPending:r}=K(t==null?void 0:t.product_id),v=l.handleSubmit(async o=>{const p={},x={};t.inventory_items.forEach(n=>p[n.inventory.id]=n.required_quantity),o.inventory.forEach(n=>x[n.inventory_item_id]=!0);const s={};o.inventory.forEach(n=>{n.inventory_item_id in p?n.required_quantity!==p[n.inventory_item_id]&&(s.update=s.update||[],s.update.push({required_quantity:g(n.required_quantity),inventory_item_id:n.inventory_item_id,variant_id:t.id})):(s.create=s.create||[],s.create.push({required_quantity:g(n.required_quantity),inventory_item_id:n.inventory_item_id,variant_id:t.id}))}),t.inventory_items.forEach(n=>{n.inventory.id in x||(s.delete=s.delete||[],s.delete.push({inventory_item_id:n.inventory.id,variant_id:t.id}))}),await c(s,{onSuccess:()=>{I.success(i("products.variant.inventory.toast.itemsManageSuccess")),u()},onError:n=>{I.error(n.message)}})});return e.jsx(h.Form,{form:l,children:e.jsxs(S,{className:"flex h-full flex-col",onSubmit:v,children:[e.jsx(h.Header,{children:e.jsxs("div",{className:"flex items-center justify-end gap-x-2",children:[e.jsx(h.Close,{asChild:!0,children:e.jsx(f,{size:"small",variant:"secondary",children:i("actions.cancel")})}),e.jsx(f,{size:"small",type:"submit",isLoading:r,children:i("actions.save")})]})}),e.jsx(h.Body,{className:"flex justify-center overflow-auto",children:e.jsxs("div",{className:"flex w-full flex-col gap-y-8 px-6 pt-12 md:w-[720px] md:pt-24",children:[e.jsx(H,{children:i(y?"products.create.inventory.heading":"fields.inventoryItems")}),e.jsxs("div",{className:"grid gap-y-4 pb-8",children:[e.jsxs("div",{className:"flex items-start justify-between gap-x-4",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx(d.Label,{children:t.title}),e.jsx(d.Hint,{children:i(y?"products.create.inventory.label":"fields.inventoryItem")})]}),e.jsx(f,{size:"small",variant:"secondary",type:"button",onClick:()=>{m.append({inventory_item_id:"",required_quantity:""})},children:i("actions.add")})]}),m.fields.map((o,p)=>e.jsx(Z,{form:l,inventoryIndex:p,inventoryItem:o,isItemOptionDisabled:_,onRemove:()=>m.remove(p)},o.id))]})]})})]})})}function de(){const{id:t,variant_id:i}=z(),{variant:u,isPending:l,isError:m,error:a}=k(t,i,{fields:F});if(m)throw a;return e.jsx(h,{children:!l&&u&&e.jsx(J,{variant:u})})}export{de as Component};
